import{A as e,C as t,D as n,E as r,O as i,S as a,_ as o,a as s,b as c,c as l,g as u,h as d,i as f,l as p,m,n as h,o as g,r as _,s as v,t as y,w as b,y as x}from"./index-C6p8qV9m.js";import{a as S,i as C,r as w,t as T}from"./validators-U8kGOQco.js";var E=e(i()),D=e(c()),O=()=>{let e=b(),t=r(),i=n(a),[c,v]=(0,E.useState)(``),[y,T]=(0,E.useState)(``),[O,k]=(0,E.useState)(``),[A,j]=(0,E.useState)(``),{register:M,handleSubmit:N,setError:P,clearErrors:F,formState:{errors:I}}=S({resolver:C(w),mode:`onChange`}),L=(0,E.useCallback)(_(async e=>{if(!(!e||e.length<3)){setIsCheckingUsername(!0);try{await x.validateUsername(e),F(`username`)}catch(e){P(`username`,{type:`manual`,message:e.response?.data?.message||`Tên hiển thị đã tồn tại`})}finally{setIsCheckingUsername(!1)}}},700),[]),R=(0,E.useCallback)(_(async e=>{if(!e){v(``);return}if(!s(e)){v(`Email không đúng định dạng`),F(`email`);return}v(``),setIsCheckingEmail(!0);try{await x.validateEmail(e),F(`email`)}catch(e){P(`email`,{type:`manual`,message:e.response?.data?.message||`Email đã tồn tại`})}finally{setIsCheckingEmail(!1)}},1200),[]),z=(0,E.useCallback)(_(e=>{if(!e){T(``);return}g(e)?T(``):(T(`Mật khẩu phải có ít nhất 6 ký tự`),F(`password`))},700),[]),B=(0,E.useCallback)(_(e=>{if(!e){k(``);return}f(A,e)?k(``):(k(`Mật khẩu xác nhận không khớp`),F(`password_confirmation`))},700),[A]);return(0,E.useEffect)(()=>()=>{t(o())},[t]),(0,D.jsxs)(`form`,{onSubmit:N(async n=>{t(d());try{let r=await x.register(n);r.access_token&&localStorage.setItem(`access_token`,r.access_token),r.refresh_token&&localStorage.setItem(`refresh_token`,r.refresh_token),t(u(r)),l.success(`Đăng ký thành công !`,{description:`Chúng tôi đã gửi một liên kết xác thực tới email của bạn. Vui lòng kiểm tra email để xác thực tài khoản.`,duration:3e3}),setTimeout(()=>{e(`/auth/login`)},500)}catch(e){let n=e.response?.data||{message:e.message};t(m(n));let r=n.message||`Đăng ký thất bại`;n.errors&&Object.keys(n.errors).forEach(e=>{P(e,{type:`manual`,message:n.errors[e][0]})}),l.error(`Đăng ký thất bại`,{description:r})}}),className:`space-y-4 w-full`,children:[(0,D.jsx)(h,{type:`text`,placeholder:`Tên Hiển thị`,...M(`username`),onChange:e=>{M(`username`).onChange(e),L(e.target.value)},className:`h-12 bg-threaditembg border-input-border rounded-xl text-normaltext placeholder:text-normaltext-tertiary ${I.username?`border-destructive`:``}`,disabled:i}),I.username&&(0,D.jsx)(`p`,{className:`text-destructive text-sm mt-1`,children:I.username.message}),(0,D.jsx)(h,{type:`email`,placeholder:`Email`,...M(`email`),onChange:e=>{M(`email`).onChange(e),R(e.target.value)},className:`h-12 bg-threaditembg border-input-border rounded-xl text-normaltext placeholder:text-normaltext-tertiary ${I.email||c?`border-destructive`:``}`,disabled:i}),c&&(0,D.jsx)(`p`,{className:`text-destructive text-sm mt-1`,children:c}),I.email&&!c&&(0,D.jsx)(`p`,{className:`text-destructive text-sm mt-1`,children:I.email.message}),(0,D.jsx)(h,{type:`password`,placeholder:`Mật Khẩu`,...M(`password`),onChange:e=>{let t=e.target.value;M(`password`).onChange(e),j(t),z(t)},className:`h-12 bg-threaditembg border-input-border rounded-xl text-normaltext placeholder:text-normaltext-tertiary ${I.password||y?`border-destructive`:``}`,disabled:i}),y&&(0,D.jsx)(`p`,{className:`text-destructive text-sm mt-1`,children:y}),I.password&&(0,D.jsx)(`p`,{className:`text-destructive text-sm mt-1`,children:I.password.message}),(0,D.jsx)(h,{type:`password`,placeholder:`Xác nhận mật khẩu`,...M(`password_confirmation`),onChange:e=>{M(`password_confirmation`).onChange(e),B(e.target.value)},className:`h-12 bg-threaditembg border-input-border rounded-xl text-normaltext placeholder:text-normaltext-tertiary ${I.password_confirmation||O?`border-destructive`:``}`,disabled:i}),O&&(0,D.jsx)(`p`,{className:`text-destructive text-sm mt-1`,children:O}),I.password_confirmation&&(0,D.jsx)(`p`,{className:`text-destructive text-sm mt-1`,children:I.password_confirmation.message}),(0,D.jsx)(p,{type:`submit`,className:`w-full h-12 bg-foreground text-background !hover:bg-systemtext cursor-pointer rounded-2xl`,disabled:i,children:i?`Đang đăng ký...`:`Đăng ký`})]})};function k(){b();let{t:e}=v(),{register:n,trigger:r,setError:i,watch:a,handleSubmit:o,formState:{errors:s}}=S({defaultValues:{firstName:``,lastName:``,email:``,password:``,password_confirmation:``},mode:`onChange`,resolver:C(w)}),c=a(`email`);(0,E.useEffect)(()=>{c&&T.test(c)&&(void 0)(c).then(e=>{e&&i(`email`,{type:`check-email`,message:`Email đã tồn tại, chọn email khác`})}),c&&r(`email`)},[c,s,i,r]);let l=a(`password`);return(0,E.useEffect)(()=>{let e=a(`password_confirmation`);e&&l!==e?r(`password_confirmation`):i(`password_confirmation`,null)},[l,a,r,i]),(0,D.jsxs)(`div`,{className:`max-w-[370px] min-w-[300px] p-6! mx-auto! flex flex-col gap-2 absolute top-full left-[50%] -translate-x-[50%] translate-y-[50%]`,children:[(0,D.jsxs)(`div`,{className:`flex flex-col gap-2`,children:[(0,D.jsx)(`h1`,{className:`text-center text-base sm:text-lg sm:my-4 text-foreground font-bold! text-[16px]`,children:e(`signup_threads`)}),(0,D.jsx)(O,{}),(0,D.jsx)(`div`,{className:`text-center`,children:(0,D.jsx)(t,{to:`/forgot-password`,className:`text-sm text-foreground`,children:e(`forgot_psw`)})}),(0,D.jsxs)(`div`,{className:`relative my-6!`,children:[(0,D.jsx)(y,{className:`bg-normaltext!`}),(0,D.jsx)(`span`,{className:`absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 px-4 text-sm text-systemtext!`,children:e(`or`)})]})]}),(0,D.jsx)(`div`,{className:`bg-card border border-border rounded-2xl p-4 sm:p-6 text-center`,children:(0,D.jsxs)(`p`,{className:`text-sm text-foreground`,children:[e(`havent_got_account`),(0,D.jsx)(t,{to:`/auth/login`,className:`text-foreground font-semibold hover:underline`,children:e(`login`)})]})})]})}var A=k;export{A as default};